{% extends "courses/course_base.html" %}
{% load courses %}

{% block js %}
$(document).ready(function(){
    $('#membership-button').click(function(e) {
	e.preventDefault();
	$(this).html('working...');
	$.ajax({
	    url: "{% url courses:toggle-membership course.id %}",
	    context: document.body,
	    type: "POST",
	    success: function(data){
		if (data.status == 'added'){
		    $('#membership-button').html("Remove membership");
		} else if (data.status == 'removed'){
		    $('#membership-button').html("Become member");
		}
	    }
	});
    });
});
{% endblock js %}

{% block course_content %}
<div id="course">
  <span class="course-sub-info">{{ course.number }} - {{ course.section }}: {{ course.semester.name }} {{ course.semester.year }} | {{ course.credits }} credit hours</span>
    {% ifpossiblemember %}
  {% if course.semester.active %}
    {% if not request.user in course.members.all %}
      <div class="right"><a id="membership-button" href="#" class="button call-to-action">Become member</a></div>
    {% else %}
      <div class="right"><a id="membership-button" href="#" class="button call-to-action">Remove membership</a></div>
    {% endif %}
  {% endif %}
{% endifpossiblemember %}
  
  <div id="description">
   {{ course.description|safe }}
  </div>
</div>
{% endblock course_content %}
